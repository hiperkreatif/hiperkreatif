---
import { SEO } from '../constants/seo';
import BaseLayout from '../layouts/BaseLayout.astro';
import { PRODUCTS } from '../constants/products';
import { getImage } from 'astro:assets';
import BgPattern from '../assets/bg-pattern.webp';

const bg = await getImage({
  src: BgPattern,
  widths: [512],        // pattern biasanya kecil
  formats: ['webp'],    // webp cukup buat modern
  quality: 70
});
---

<BaseLayout>
  <div
    class="absolute inset-0 -z-10 opacity-20"
    style={`background-image: url(${bg.src}); background-size: repeat; background-position: center;`}
  />
  <div class="absolute inset-0 w-full h-full">
    <div class="absolute w-[500px] h-[500px] bg-black/5 dark:bg-black/5 rounded-full blur-3xl -top-48 -left-24 animate-pulse" />
    <div class="absolute w-[400px] h-[400px] bg-black/5 dark:bg-black/5 rounded-full blur-3xl -bottom-32 -right-24 animate-pulse delay-700" />
  </div>

  <div class="max-w-6xl mx-auto">
    <section class="sm:mt-36 mt-24 flex flex-col items-center justify-center text-center px-6 relative">
      <h1 class="text-5xl md:text-7xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 tracking-tight leading-tight">
        {SEO.heroTitle}
      </h1>
      <p class="text-lg md:text-xl text-gray-600 mb-8 max-w-3xl leading-relaxed">
        {SEO.description}
      </p>
      <form id="searchForm" class="flex w-full max-w-2xl mx-auto group" role="search">
        <input
          type="search"
          placeholder="Cari produk, tools, atau layanan..."
          class="flex-1 rounded-full px-6 py-4 border-2 border-gray-200 focus:outline-none focus:border-black focus:ring-4 focus:ring-black/5 text-lg bg-white/80 backdrop-blur-sm shadow-lg transition-all"
          aria-label="Cari produk, tools, atau layanan"
        />
      </form>
    </section>

    <section class="px-6 sm:px-4 mt-24">
      <script type="module" src="/scripts/tagFilter.js"></script>

      <!-- Tag Filter -->
      <div class="relative w-full mb-8">
        <div id="tag-filter" class="flex gap-3 overflow-x-auto pb-4 scrollbar-none md:flex-wrap md:justify-center md:overflow-visible">
          {Array.from(new Set(PRODUCTS.flatMap(p => p.tags))).map(tag => (
            <button
              class={`px-5 py-2 rounded-full border-2 text-sm font-semibold transition-all duration-300 whitespace-nowrap
                bg-white/80 backdrop-blur-sm text-gray-700 border-gray-200 hover:border-gray-900 hover:text-gray-900
                data-[selected=true]:bg-gray-900 data-[selected=true]:text-white data-[selected=true]:border-gray-900 data-[selected=true]:shadow-lg
                shrink-0`}
              type="button"
              data-tag={tag}
              data-selected="false"
            >
              {tag}
            </button>
          ))}
        </div>
        <div class="absolute left-0 right-0 bottom-0 h-4 pointer-events-none bg-gradient-to-t from-white to-transparent md:hidden"/>
      </div>

      <!-- Product List -->
      <div id="product-list" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {PRODUCTS.map(product => (
          <a
            href={product.url}
            target="_blank"
            rel="noopener"
            class="group bg-white/80 backdrop-blur-sm rounded-2xl p-5 flex flex-col border-2 border-gray-100 hover:border-gray-900 transition-all duration-300 cursor-pointer no-underline hover:shadow-2xl"
          >
            <div class="relative overflow-hidden rounded-xl mb-4">
              <img
                src={product.thumbnail}
                alt={product.title}
                class="w-full h-48 object-cover transform group-hover:scale-105 transition-transform duration-500"
                loading="lazy"
              />
            </div>
            <h3 class="text-lg font-bold mb-2 text-gray-900 text-left group-hover:text-black">
              {product.title}
            </h3>
            <p class="text-base text-gray-600 text-justify mb-4 line-clamp-4 leading-relaxed">
              {product.description}
            </p>
            <div class="flex flex-wrap gap-2 mt-auto">
              {product.tags.map(tag => (
                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">
                  {tag}
                </span>
              ))}
            </div>
          </a>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>
